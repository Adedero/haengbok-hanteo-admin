import{d as C,u as E,a as B,r as o,o as n,c,b as l,e as t,f as q,s as N,_ as M,g as A,h as V,i as S,t as L,j as U,k as x,l as G,m as H,n as O,F as T,p as z,q as J,v as K,w as Q}from"./index-DRroArCF.js";const W=C({__name:"PasswordReset",props:{user:{}},emits:["password-reset"],setup(h){const k=E(),g=B(),u=o(!1),y=o(null),s=o(!1),a=async()=>{await V(`api/user-password-reset/${h.user._id}`,{loading:u,error:y,config:{router:k,method:"PUT"}},()=>{s.value=!0})},b=()=>{g.require({message:"Do you want to reset the user's password?",header:"Reset Password",icon:"pi pi-info-circle",rejectLabel:"Cancel",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Reset",severity:"danger"},accept:()=>{a()}})};return(f,i)=>{const w=N,m=M,$=A;return n(),c("div",null,[l(w,{onClick:b,loading:u.value,severity:"danger",label:"Reset Password",icon:"pi pi-key",fluid:""},null,8,["loading"]),i[2]||(i[2]=t("small",{class:"text-red-500"},[q(" Reset the user's password to "),t("span",{class:"font-semibold"},"000000")],-1)),l(m,{error:y.value,overlay:"","show-header":""},null,8,["error"]),l($,{onHide:i[0]||(i[0]=P=>f.$emit("password-reset")),visible:s.value,"onUpdate:visible":i[1]||(i[1]=P=>s.value=P),"show-okay-button":"",overlay:"",message:"Password has been reset successfully to 000000"},null,8,["visible"])])}}}),X={class:"bg-white rounded-lg p-4 w-full"},Y={class:"flex items-center justify-between"},Z={class:"flex items-center gap-1"},ee={class:"font-medium"},se={class:"flex items-center gap-1"},te={key:0,class:"flex items-center gap-2"},le={class:"mt-4 grid md:grid-cols-2 gap-4"},ae={class:"md:col-span-2"},oe={class:"md:col-span-2"},ne={key:0,class:"text-sm"},ie={key:1,class:"grid md:grid-cols-2 gap-4"},re={class:"grid"},ue=["href","download"],de={class:"grid"},ce=C({__name:"UserDetails",props:{user:{},index:{}},emits:["deleteUser"],setup(h,{emit:k}){const g=E(),u=B(),y=k,s=o({...h.user,birthday:new Date(h.user.birthday)}),a=o(!1),b=S(()=>Object.values(s.value).some(d=>d===""||d===null||d===void 0)||!s.value.location.country),f=o(!1),i=o(null),w=async()=>{var d,e,v;((d=s.value.kyc)==null?void 0:d.status)==="successful"&&(s.value.kyc={...s.value.kyc??{},verifiedAt:new Date(Date.now())}),((e=s.value.kyc)==null?void 0:e.status)!=="successful"&&((v=s.value.kyc)==null||delete v.verifiedAt),await V(`api/users/${s.value._id}`,{loading:f,error:i,config:{router:g,method:"PUT",body:s.value}},()=>{a.value=!1})},m=o(!1),$=o(null),P=async()=>{await V(`api/users/${s.value._id}`,{loading:m,error:$,config:{router:g,method:"DELETE"}},()=>{y("deleteUser",s.value._id)})},p=()=>{u.require({message:"Do you want to delete this user? This action cannot be reversed.",header:"Delete User",icon:"pi pi-info-circle",rejectLabel:"Cancel",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{P()}})};return(d,e)=>{var j;const v=N,R=M,_=G,D=H,F=O,I=W;return n(),c("div",X,[t("div",Y,[t("div",Z,[t("p",null,L(d.index+1)+".",1),t("p",ee,L(s.value.name),1)]),t("div",se,[a.value?x("",!0):(n(),U(v,{key:0,onClick:e[0]||(e[0]=r=>a.value=!0),size:"small",label:"Edit",icon:"pi pi-user-edit"})),a.value?x("",!0):(n(),U(v,{key:1,onClick:p,size:"small",label:"Delete",icon:"pi pi-trash",severity:"danger",loading:m.value},null,8,["loading"]))]),a.value?(n(),c("div",te,[l(v,{onClick:w,disabled:b.value,loading:f.value,size:"small",label:"Save",icon:"pi pi-check"},null,8,["disabled","loading"]),l(v,{onClick:e[1]||(e[1]=r=>a.value=!1),size:"small",severity:"secondary",label:"Cancel",icon:"pi pi-times"})])):x("",!0)]),e[17]||(e[17]=t("hr",{class:"my-2"},null,-1)),l(R,{error:$.value,closable:""},null,8,["error"]),t("div",le,[t("div",null,[e[9]||(e[9]=t("label",{for:"name",class:"text-sm text-slate-500 font-medium"},"Name",-1)),l(_,{modelValue:s.value.name,"onUpdate:modelValue":e[2]||(e[2]=r=>s.value.name=r),modelModifiers:{trim:!0},id:"name",fluid:"",disabled:!a.value},null,8,["modelValue","disabled"])]),t("div",null,[e[10]||(e[10]=t("label",{for:"gender",class:"text-sm text-slate-500 font-medium"},"Gender",-1)),l(D,{modelValue:s.value.gender,"onUpdate:modelValue":e[3]||(e[3]=r=>s.value.gender=r),options:["female","male","other"],"input-id":"gender",fluid:"",disabled:!a.value},null,8,["modelValue","disabled"])]),t("div",ae,[e[11]||(e[11]=t("label",{for:"email",class:"text-sm text-slate-500 font-medium"},"Email",-1)),l(_,{modelValue:s.value.email,"onUpdate:modelValue":e[4]||(e[4]=r=>s.value.email=r),type:"email",id:"email",fluid:"",disabled:!a.value},null,8,["modelValue","disabled"])]),t("div",null,[e[12]||(e[12]=t("label",{for:"birthday",class:"text-sm text-slate-500 font-medium"},"Birthday",-1)),l(F,{modelValue:s.value.birthday,"onUpdate:modelValue":e[5]||(e[5]=r=>s.value.birthday=r),"input-id":"birthday",dateFormat:"dd MM, yy",fluid:"",disabled:!a.value},null,8,["modelValue","disabled"])]),t("div",null,[e[13]||(e[13]=t("label",{for:"location",class:"text-sm text-slate-500 font-medium"},"Location",-1)),l(_,{modelValue:s.value.location.country,"onUpdate:modelValue":e[6]||(e[6]=r=>s.value.location.country=r),id:"location",fluid:"",disabled:!a.value},null,8,["modelValue","disabled"])]),t("div",oe,[e[16]||(e[16]=t("p",{class:"text-sm text-slate-500 font-medium"},"ID Verification",-1)),(j=s.value.kyc)!=null&&j.document?(n(),c("div",ie,[t("div",re,[e[14]||(e[14]=t("p",{class:"text-sm text-slate-500 font-medium"},"Document",-1)),t("a",{href:`${s.value.kyc.document}`,download:`ID-${s.value.name}.${s.value.kyc.ext}`},[l(v,{label:"Download document",icon:"pi pi-file",fluid:""})],8,ue)]),t("div",de,[e[15]||(e[15]=t("label",{for:"kyc-status",class:"text-sm text-slate-500 font-medium"},"Status",-1)),l(D,{modelValue:s.value.kyc.status,"onUpdate:modelValue":e[7]||(e[7]=r=>s.value.kyc.status=r),options:["pending","successful","failed"],"input-id":"kyc-status",fluid:"",disabled:!a.value},null,8,["modelValue","disabled"])])])):(n(),c("div",ne," No ID has been submitted by this user for verification. "))]),a.value?(n(),U(I,{key:0,user:s.value,onPasswordReset:e[8]||(e[8]=r=>a.value=!1)},null,8,["user"])):x("",!0)])])}}}),me={class:"grid gap-4"},pe=C({__name:"PageLoader",setup(h){return(k,g)=>{const u=J;return n(),c("div",me,[(n(),c(T,null,z(3,y=>t("div",{key:y,class:"bg-white rounded-lg p-4 grid grid-cols-2 gap-4"},[l(u,{height:"2.5rem",class:"col-span-1"}),l(u,{height:"2.5rem",class:"col-span-1"}),l(u,{height:"2.5rem",class:"col-span-2"}),l(u,{height:"2.5rem",class:"col-span-1"}),l(u,{height:"2.5rem",class:"col-span-1"})])),64))])}}}),ve={class:"p-4 lg:p-0 md:h-[calc(100dvh-7rem)]"},fe={class:"fixed z-[100] top-2 right-16 lg:top-6 lg:right-8 flex items-center gap-2"},ge={key:0,class:"font-bold text-[--p-primary-color]"},ye={key:1,class:"grid gap-2 mb-4"},_e=C({__name:"UsersView",setup(h){const k=E(),g=o(0),u=o(0),y=p=>{u.value=p.page,w()},s=o(10),a=S(()=>s.value*u.value),b=o(!1),f=o(null),i=o(null);async function w(){await V(`api/users?skip=${a.value}&limit=${s.value}`,{loading:b,error:f,config:{router:k,cache:!0}},p=>{i.value=p.items})}const m=o();async function $(){await V("api/users-count",{loading:b,error:f,config:{router:k,cache:!0}},p=>{m.value=p.count})}const P=p=>{i.value&&(i.value=i.value.filter(d=>d._id!==p),m.value=Math.max((m.value??0)-1,0))};return K(async()=>{await Promise.all([w(),$()])}),(p,d)=>{const e=M,v=ce,R=Q;return n(),c("main",ve,[t("div",fe,[m.value?(n(),c("p",ge," ("+L(m.value)+") ",1)):x("",!0)]),b.value?(n(),U(pe,{key:0})):x("",!0),l(e,{error:f.value,"show-retry-button":"",onRetry:w,"show-header":""},null,8,["error"]),!b.value&&!f.value&&i.value?(n(),c("div",ye,[(n(!0),c(T,null,z(i.value,(_,D)=>(n(),c("div",{key:_._id},[l(v,{user:_,index:D,onDeleteUser:P},null,8,["user","index"])]))),128))])):x("",!0),t("div",null,[l(R,{first:g.value,"onUpdate:first":d[0]||(d[0]=_=>g.value=_),onPage:y,rows:s.value,totalRecords:m.value,template:"FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink"},null,8,["first","rows","totalRecords"])])])}}});export{_e as default};
